################################
# é¢„è®¾ï¼Œä¾¿äºå¼•ç”¨
behavior: &behavior {type: http, interval: 86400, health-check: {enable: true, url: "http://www.gstatic.com/generate_204", interval: 900}, exclude-filter: "å‰©ä½™|æµé‡|åˆ°æœŸ|æ—¶é—´|å®˜ç½‘|åŸŸå|å·¥å•|å®¢æœ"}
proxylist: &proxylist {type: select, proxies: [âš™ï¸ é»˜è®¤, ğŸ¯ ç›´è¿, ğŸš€ ä»£ç†, ğŸ‡ºğŸ‡¸ ç¾å›½, ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡, ğŸ‡¯ğŸ‡µ æ—¥æœ¬, ğŸ‡­ğŸ‡° é¦™æ¸¯, ğŸ‡¹ğŸ‡¼ å°æ¹¾], include-all-providers: true}

################################
# èŠ‚ç‚¹è®¢é˜…ï¼Œå¯å¡«å†™å¤šä¸ªæœºåœº
proxy-providers:
  "æœºåœº1":
    <<: *behavior
    url: "è¯·åœ¨æ­¤å¤„å¡«å…¥è®¢é˜…é“¾æ¥"
    path: "./providers/æœºåœº1"

  "æœºåœº2":
    <<: *behavior
    url: "è¯·åœ¨æ­¤å¤„å¡«å…¥è®¢é˜…é“¾æ¥"
    path: "./providers/æœºåœº2"

  "æœºåœº3":
    <<: *behavior
    url: "è¯·åœ¨æ­¤å¤„å¡«å…¥è®¢é˜…é“¾æ¥"
    path: "./providers/æœºåœº3"

  # ä½ å¯ä»¥æ·»åŠ æ›´å¤š

################################
# ä»¥ä¸‹ä¸ºå†…æ ¸å‚æ•°ï¼Œä¸å»ºè®®ä¿®æ”¹

# å…¨å±€å‚æ•°
mixed-port: 7890
mode: rule
log-level: silent
allow-lan: true
unified-delay: true
global-client-fingerprint: chrome
external-controller: 127.0.0.1:9090
external-ui: "./ui"
external-ui-url: "https://github.com/MetaCubeX/metacubexd/archive/refs/heads/gh-pages.zip"

# GeoX ç›¸å…³è®¾ç½®
geodata-mode: true
geo-auto-update: true
geo-update-interval: 24
geox-url:
  geoip: "https://cdn.jsdelivr.net/gh/Cornfy/geoip@release/geoip-asn.dat"
  geosite: "https://cdn.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geosite.dat"

# åŸŸåå—…æ¢
sniffer:
  enable: true
  sniff:
    HTTP: {ports: [80, 8080-8880]}
    TLS: {ports: [443, 8443]}
    QUIC: {ports: [443, 8443]}

# åŸŸåè§£æ
dns:
  enable: true
  prefer-h3: true
  respect-rules: true
  listen: 0.0.0.0:1053
  enhanced-mode: fake-ip
  fake-ip-range: 28.0.0.1/8
  default-nameserver:
    # ç”¨äºè§£æ DNS æœåŠ¡å™¨åŸŸåçš„ DNS æœåŠ¡å™¨
    # ä»…é™çº¯ IPï¼Œå¯ä¸ºåŠ å¯† DNS
    - "tls://223.5.5.5#ğŸš© å›½å†…"
  proxy-server-nameserver:
    # ä»…ç”¨äºä»£ç†èŠ‚ç‚¹çš„åŸŸåè§£æ
    - "tls://223.5.5.5#ğŸš© å›½å†…"
  nameserver-policy:
    # æŒ‡å®šç‰¹å®šæµé‡è¯·æ±‚ä½¿ç”¨çš„ DNS æœåŠ¡å™¨
    geosite:category-ads-all: [rcode://success]
    geosite:cn:
      - "https://dns.alidns.com/dns-query#ğŸš© å›½å†…"
      - "https://doh.pub/dns-query#ğŸš© å›½å†…"
    geoip:cn:
      - "https://dns.alidns.com/dns-query#ğŸš© å›½å†…"
      - "https://doh.pub/dns-query#ğŸš© å›½å†…"
  nameserver:
    - "https://dns.cloudflare.com/dns-query#ğŸ“¡ DNS"
    - "https://dns.google/dns-query#ğŸ“¡ DNS"

# è™šæ‹Ÿç½‘å¡
tun:
  enable: true
  stack: gVisor
  device: utun0
  dns-hijack:
   - udp://0.0.0.0:53
   - tcp://0.0.0.0:53
  auto-route: true
  auto-detect-interface: true
  auto-redirect: true
  strict-route: true

# ä»£ç†èŠ‚ç‚¹
proxies:
  - {name: ğŸ¯ ç›´è¿, type: direct, udp: true}
  - {name: ğŸš« æ‹¦æˆª, type: reject, udp: true}
  - {name: dns-out, type: dns}

# ä»£ç†ç»„
proxy-groups:
  - {name: âš™ï¸ é»˜è®¤, type: select, proxies: [ğŸš€ ä»£ç†, ğŸ¯ ç›´è¿, ğŸ‡ºğŸ‡¸ ç¾å›½, ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡, ğŸ‡¯ğŸ‡µ æ—¥æœ¬, ğŸ‡­ğŸ‡° é¦™æ¸¯, ğŸ‡¹ğŸ‡¼ å°æ¹¾], include-all-providers: true}
  - {name: ğŸš© å›½å†…, type: select, proxies: [ğŸ¯ ç›´è¿, âš™ï¸ é»˜è®¤]}
  - {name: ğŸ•¹ï¸ æ¸¸æˆ, <<: *proxylist}
  - {name: ğŸ“º å½±éŸ³, <<: *proxylist}
  - {name: ğŸ¤– AI, <<: *proxylist}
  - {name: ğŸ” è°·æ­Œ, <<: *proxylist}
  - {name: ğŸ è‹¹æœ, <<: *proxylist}
  - {name: â“‚ï¸ å¾®è½¯, <<: *proxylist}
  - {name: âœˆï¸ ç”µæŠ¥, <<: *proxylist}
  - {name: ğŸ•Šï¸ æ¨ç‰¹, <<: *proxylist}
  - {name: ğŸ“¡ DNS, type: select, hidden: true, proxies: [ğŸ‡ºğŸ‡¸ ç¾å›½]}
  - {name: ğŸš€ ä»£ç†, type: url-test, hidden: true, include-all-providers: true}
  - {name: ğŸ‡ºğŸ‡¸ ç¾å›½, type: url-test, hidden: true, include-all-providers: true, filter: "(?i)ç¾|ç¾å›½|US|UnitedStates"}
  - {name: ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡, type: url-test, hidden: true, include-all-providers: true, filter: "(?i)æ–°|æ–°åŠ å¡|SG|Singapore"}
  - {name: ğŸ‡¯ğŸ‡µ æ—¥æœ¬, type: url-test, hidden: true, include-all-providers: true, filter: "(?i)æ—¥|æ—¥æœ¬|JP|Japan"}
  - {name: ğŸ‡­ğŸ‡° é¦™æ¸¯, type: url-test, hidden: true, include-all-providers: true, filter: "(?i)æ¸¯|é¦™æ¸¯|HK|HongKong"}
  - {name: ğŸ‡¹ğŸ‡¼ å°æ¹¾, type: url-test, hidden: true, include-all-providers: true, filter: "(?i)å°|å°æ¹¾|TW|TaiWan"}

# åˆ†æµè§„åˆ™ï¼Œè¶Šé å‰ä¼˜å…ˆçº§è¶Šé«˜
rules:
  # åŒ¹é…éœ€ç›´è¿çš„ç¨‹åº
  - PROCESS-NAME-REGEX,(?i)ssh,ğŸ¯ ç›´è¿
  - PROCESS-NAME-REGEX,(?i)bittorrent,ğŸ¯ ç›´è¿
  - PROCESS-NAME-REGEX,(?i)tailscale,ğŸ¯ ç›´è¿

  # åŒ¹é… DNSï¼Œäº¤ç»™å†…éƒ¨ dns æ¨¡å—å¤„ç†
  - AND,((DST-PORT,53),(NETWORK,UDP)),dns-out
  - AND,((DST-PORT,53/853),(NETWORK,TCP)),dns-out
  - DOMAIN-SUFFIX,dns.cloudflare.com,dns-out
  - DOMAIN-SUFFIX,dns.google.com,dns-out
  - DOMAIN-SUFFIX,dns.alidns.com,dns-out
  - DOMAIN-SUFFIX,doh.pub,dns-out
    
  # åŒ¹é…ç§æœ‰åŸŸåï¼Œèµ°ç›´è¿
  - GEOSITE,private,ğŸ¯ ç›´è¿

  # åŒ¹é…å¹¿å‘ŠåŸŸåï¼Œæ‹¦æˆª
  - GEOSITE,category-ads-all,ğŸš« æ‹¦æˆª

  # åŒ¹é…å›½é™…æœåŠ¡å•†çš„å›½å†…åŸŸåï¼Œèµ°å›½å†…ä»£ç†ç»„
  - GEOSITE,category-games@cn,ğŸš© å›½å†…
  - GEOSITE,microsoft@cn,ğŸš© å›½å†…
  - GEOSITE,apple@cn,ğŸš© å›½å†…

  # åŒ¹é…å›½é™…æœåŠ¡å•†çš„åŸŸåï¼Œèµ°ç›¸åº”ä»£ç†ç»„
  - GEOSITE,category-games,ğŸ•¹ï¸ æ¸¸æˆ
  - AND,((GEOSITE,category-entertainment),(NOT,((GEOSITE,category-games)))),ğŸ“º å½±éŸ³
  - GEOSITE,category-ai-!cn,ğŸ¤– AI
  - GEOSITE,google,ğŸ” è°·æ­Œ
  - GEOSITE,apple,ğŸ è‹¹æœ
  - AND,((GEOSITE,microsoft),(NOT,((GEOSITE,github)))),â“‚ï¸ å¾®è½¯
  - GEOSITE,telegram,âœˆï¸ ç”µæŠ¥
  - GEOSITE,twitter,ğŸ•Šï¸ æ¨ç‰¹

  # åŒ¹é…å›½å†…åŸŸåï¼Œèµ°å›½å†…ä»£ç†ç»„
  - GEOSITE,cn,ğŸš© å›½å†…

  # åŒ¹é…ç§æœ‰ IP ï¼Œèµ°ç›´è¿ï¼Œä¸è§£æåŸŸå
  - GEOIP,private,ğŸ¯ ç›´è¿,no-resolve

  # åŒ¹é…å›½é™…æœåŠ¡å•†çš„ IP ï¼Œèµ°ç›¸åº”ä»£ç†ç»„ï¼Œä¸è§£æåŸŸå
  - GEOIP,telegram,âœˆï¸ ç”µæŠ¥,no-resolve

  # åŒ¹é…å›½å†… IP ï¼Œèµ°å›½å†…ä»£ç†ç»„ï¼Œä¸è§£æåŸŸå
  - GEOIP,cn,ğŸš© å›½å†…,no-resolve

  # æœ€ç»ˆå…œåº•è§„åˆ™ï¼ŒåŒ¹é…æ‰€ä»¥æœªè¢«è§„åˆ™åˆ†æµçš„æµé‡ï¼Œèµ°é»˜è®¤ç»„
  - MATCH,âš™ï¸ é»˜è®¤
